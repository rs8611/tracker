<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pregnancy Journey Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('Debug');
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId;
        let checkedDays = {};

        window.firebaseInitialized = false;

        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('userIdDisplay').textContent = `User ID: ${userId}`;
                        window.firebaseInitialized = true;
                        startListeningForData();
                    } else {
                        // Sign in anonymously if no user is authenticated
                        if (initialAuthToken) {
                             await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                             await signInAnonymously(auth);
                        }
                    }
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                window.firebaseInitialized = false;
                document.getElementById('userIdDisplay').textContent = `User ID: Error`;
            }
        }

        function startListeningForData() {
            const trackerDocRef = doc(db, `/artifacts/${appId}/users/${userId}/pregnancy-tracker/tracker-data`);
            onSnapshot(trackerDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    checkedDays = docSnap.data().checkedDays || {};
                } else {
                    checkedDays = {};
                }
                renderCalendar();
                updateProgress();
            }, (error) => {
                console.error("Error listening to document:", error);
                renderCalendar();
                updateProgress();
            });
        }
        
        async function saveCheckedDays() {
            if (window.firebaseInitialized && userId) {
                const trackerDocRef = doc(db, `/artifacts/${appId}/users/${userId}/pregnancy-tracker/tracker-data`);
                try {
                    await setDoc(trackerDocRef, { checkedDays });
                } catch (error) {
                    console.error("Failed to save data to Firestore:", error);
                }
            }
        }

        const startDate = new Date('2025-05-29T00:00:00');
        const dueDate = new Date('2026-03-05T00:00:00');
        const totalDays = Math.round((dueDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

        let currentDate = new Date(startDate.getFullYear(), startDate.getMonth(), 1);

        const calendar = document.getElementById('calendar');
        const monthYearEl = document.getElementById('monthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');

        const currentWeekEl = document.getElementById('currentWeek');
        const currentTrimesterEl = document.getElementById('currentTrimester');
        const daysAlongEl = document.getElementById('daysAlong');
        const progressBarEl = document.getElementById('progressBar');
        const progressTextEl = document.getElementById('progressText');

        function renderCalendar() {
            calendar.innerHTML = '';
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();

            monthYearEl.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                calendar.appendChild(document.createElement('div'));
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const dayDate = new Date(year, month, i);
                if (dayDate < startDate || dayDate > dueDate) continue;

                const dayEl = document.createElement('div');
                dayEl.className = 'day p-2 h-16 md:h-20 flex flex-col justify-start items-center border border-gray-200 rounded-lg';
                
                const dayNumber = document.createElement('span');
                dayNumber.textContent = i;
                dayEl.appendChild(dayNumber);

                const dateString = dayDate.toISOString().split('T')[0];

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'day-checkbox';
                checkbox.dataset.date = dateString;
                checkbox.checked = !!checkedDays[dateString];
                dayEl.appendChild(checkbox);

                if (checkedDays[dateString]) {
                    dayEl.classList.add('checked');
                }

                const today = new Date();
                if (dayDate.toDateString() === today.toDateString()) {
                    dayEl.classList.add('today');
                }
                
                const daysSinceStart = Math.round((dayDate - startDate) / (1000 * 60 * 60 * 24));

                if ((daysSinceStart + 1) % 7 === 0) {
                    const weekNumber = (daysSinceStart + 1) / 7;
                    const weekNumberText = document.createElement('p');
                    weekNumberText.textContent = `${weekNumber} Weeks!!!`;
                    weekNumberText.className = 'milestone-text';
                    dayEl.appendChild(weekNumberText);
                }
                
                if (dayDate.toDateString() === dueDate.toDateString()) {
                    dayEl.classList.add('due-date');
                    const dueDateText = document.createElement('p');
                    dueDateText.textContent = 'Due Date!';
                    dueDateText.className = 'text-xs mt-1 font-bold';
                    dayEl.appendChild(dueDateText);
                }

                calendar.appendChild(dayEl);
            }
        }

        function updateProgress() {
            const checkedCount = Object.keys(checkedDays).length;
            const daysSinceStart = Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const currentWeek = Math.ceil(daysSinceStart / 7);
            currentWeekEl.textContent = currentWeek > 40 ? 40 : currentWeek;

            let trimester = 1;
            if (currentWeek > 27) trimester = 3;
            else if (currentWeek > 13) trimester = 2;
            currentTrimesterEl.textContent = trimester;

            daysAlongEl.textContent = `${checkedCount} / ${totalDays}`;

            const progressPercentage = (checkedCount / totalDays) * 100;
            progressBarEl.style.width = `${progressPercentage}%`;
            progressTextEl.textContent = `${Math.round(progressPercentage)}% Complete`;
        }

        calendar.addEventListener('click', function(e) {
            if (e.target.classList.contains('day-checkbox')) {
                const date = e.target.dataset.date;
                if (e.target.checked) {
                    checkedDays[date] = true;
                } else {
                    delete checkedDays[date];
                }
                saveCheckedDays();
                updateProgress();
            }
        });

        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        currentDate = new Date();
        currentDate.setDate(1);
        renderCalendar();
        updateProgress();

        initializeFirebase();
    </script>
    <!-- Chosen Palette: Serene Peach -->
    <!-- Application Structure Plan: The application is designed as a single-page dashboard. The main view is an an interactive monthly calendar, allowing users to easily navigate through their pregnancy journey. Above the calendar, a dynamic summary panel shows key stats: current week, trimester, and a progress bar for days completed. This structure was chosen for its intuitive and at-a-glance usability. Users can immediately see their current status and explore past or future months without leaving the page. The primary interaction is checking off days, which provides a sense of accomplishment and progress. -->
    <!-- Visualization & Content Choices: Report Info: Start/Due Dates -> Goal: Track daily progress -> Viz/Presentation: Interactive Calendar Grid (HTML/CSS) -> Interaction: Click/tap to check off a day. State is saved to Firebase Firestore. -> Justification: A calendar is the most intuitive way to visualize a timeline. Checkboxes provide satisfying tactile feedback. Report Info: Key Milestones -> Goal: Highlight important dates -> Viz/Presentation: Styled text labels on the calendar -> Interaction: Visual cue -> Justification: Clearly marks significant events like the 12-week milestone and due date. Report Info: Overall Progress -> Goal: Show progress towards due date -> Viz/Presentation: HTML/CSS Progress Bar -> Interaction: Visual feedback based on checked days -> Justification: Provides a clear, immediate sense of the journey's progression. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFF7F0;
            color: #5C4033;
        }
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        .day {
            transition: all 0.2s ease-in-out;
            position: relative;
        }
        .day.checked {
            background-color: #FABDA3;
            color: #5C4033;
            border-radius: 0.5rem;
        }
        .day.today {
            border: 2px solid #E57373;
            border-radius: 0.5rem;
        }
        .day.milestone {
            background-color: #FFE0B2;
        }
        .day.due-date {
            background-color: #E57373;
            color: white;
        }
        .day-checkbox {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid #D1C4E9;
            border-radius: 4px;
        }
        .day-checkbox:checked {
            background-color: #8CC084;
            border-color: #7CB342;
        }
        .day-checkbox:checked::after {
            content: '✔';
            display: block;
            text-align: center;
            color: white;
            font-size: 10px;
            line-height: 14px;
        }
        .progress-bar-bg {
            background-color: #E0E0E0;
        }
        .progress-bar-fill {
            background-color: #8CC084;
            transition: width 0.5s ease-in-out;
        }
        .nav-button {
            background-color: #FABDA3;
            color: #5C4033;
            transition: background-color 0.2s;
        }
        .nav-button:hover {
            background-color: #F5A684;
        }
        .milestone-text {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 300;
            font-style: italic;
            color: #E57373;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-[#5C4033]">Our Pregnancy Journey</h1>
            <p class="text-lg text-[#8D6E63] mt-2">From May 29, 2025 to March 5, 2026</p>
        </header>

        <main>
            <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold mb-4 text-center">Progress Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-sm text-gray-500">Current Week</p>
                        <p id="currentWeek" class="text-2xl font-bold">1</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Trimester</p>
                        <p id="currentTrimester" class="text-2xl font-bold">1</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Days Along</p>
                        <p id="daysAlong" class="text-2xl font-bold">0 / 280</p>
                    </div>
                </div>
                <div class="mt-6">
                    <div class="progress-bar-bg w-full h-4 rounded-full overflow-hidden">
                        <div id="progressBar" class="progress-bar-fill h-full" style="width: 0%;"></div>
                    </div>
                    <p id="progressText" class="text-center text-sm mt-2 text-gray-600">0% Complete</p>
                </div>
            </div>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-4 md:p-6">
                <div class="flex justify-between items-center mb-4">
                    <button id="prevMonth" class="nav-button font-bold py-2 px-4 rounded-lg">&lt; Prev</button>
                    <h2 id="monthYear" class="text-2xl font-bold text-center"></h2>
                    <button id="nextMonth" class="nav-button font-bold py-2 px-4 rounded-lg">Next &gt;</button>
                </div>
                <div class="grid calendar-grid gap-1 text-center font-semibold text-[#8D6E63] mb-2">
                    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                </div>
                <div id="calendar" class="grid calendar-grid gap-1"></div>
            </div>
            <div id="userIdDisplay" class="mt-4 text-center text-sm text-gray-500"></div>
        </main>

        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>Wishing you a healthy and happy pregnancy journey!</p>
        </footer>
    </div>
</body>
</html>